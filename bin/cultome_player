#!/usr/bin/env ruby
# encoding: utf-8

require 'cultome_player'
#require 'active_record'

#ActiveRecord::Base.establish_connection(adapter: 'sqlite3', database: '/home/csoria/.cultome/db_cultome.dat')

class MyPlayer
    include CultomePlayer

    def initialize(env={})
        set_environment(env)
    end
end

@p = MyPlayer.new({
    user_dir: '/home/csoria/tmp',
})
@p.check_integrity
@p.launch_external_music_player
@p.connect_external_music_player('localhost', 20103)
@p.register_event_listener(:player_state_updated) do |old_state, new_state|
    #puts "##### player_state_updated: OLD: #{old_state} => New: #{new_state}"
    @p.display_with_prompt(@p.execute('next').first) if new_state == :EOM 
end

system("clear") if @p.os == :linux

@p.begin_interactive
@p.stop_in_external_player
